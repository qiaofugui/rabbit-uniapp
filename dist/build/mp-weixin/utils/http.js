"use strict";const e=require("../common/vendor.js");require("../stores/index.js");const t=require("../stores/modules/member.js"),o={invoke(e){var o;e.url.startsWith("http")||(e.url="https://pcapi-xiaotuxian-front-devtest.itheima.net"+e.url),e.timeout=1e4,e.header={...e.header,"source-client":"miniapp"};const s=null==(o=t.useMemberStore().profile)?void 0:o.token;s&&(e.header.Authorization=s)}};e.index.addInterceptor("request",o),e.index.addInterceptor("uploadFile",o);exports.http=o=>new Promise(((s,i)=>{e.index.request({...o,success(o){if(o.statusCode>=200&&o.statusCode<300)s(o.data);else if(401===o.statusCode){t.useMemberStore().clearProfile(),e.index.navigateTo({url:"/pages/login/login"}),i(o)}else e.index.showToast({icon:"none",title:o.data.msg||"请求错误"}),i(o)},fail(t){e.index.showToast({icon:"none",title:"网络错误，换个网络试试"}),i(t)}})}));
