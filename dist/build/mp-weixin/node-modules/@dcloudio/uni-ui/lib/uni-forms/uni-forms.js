"use strict";const e=require("../../../../../common/vendor.js"),t={name:"uniForms",emits:["validate","submit"],options:{virtualHost:!0},props:{value:{type:Object,default:()=>null},modelValue:{type:Object,default:()=>null},model:{type:Object,default:()=>null},rules:{type:Object,default:()=>({})},errShowType:{type:String,default:"undertext"},validateTrigger:{type:String,default:"submit"},labelPosition:{type:String,default:"left"},labelWidth:{type:[String,Number],default:""},labelAlign:{type:String,default:"left"},border:{type:Boolean,default:!1}},provide(){return{uniForm:this}},data:()=>({formData:{},formRules:{}}),computed:{localData(){const t=this.model||this.modelValue||this.value;return t?e.deepCopy(t):{}}},watch:{rules:{handler:function(e,t){this.setRules(e)},deep:!0,immediate:!0}},created(){getApp().$vm.$.appContext.config.globalProperties.binddata||(getApp().$vm.$.appContext.config.globalProperties.binddata=function(e,t,a){if(a)this.$refs[a].setValue(e,t);else{let a;for(let e in this.$refs){const t=this.$refs[e];if(t&&t.$options&&"uniForms"===t.$options.name){a=t;break}}if(!a)return console.error("当前 uni-froms 组件缺少 ref 属性");a.setValue(e,t)}}),this.childrens=[],this.inputChildrens=[],this.setRules(this.rules)},methods:{setRules(t){this.formRules=Object.assign({},this.formRules,t),this.validator=new e.SchemaValidator(t)},setValue(t,a){let i=this.childrens.find((e=>e.name===t));return i?(this.formData[t]=e.getValue(t,a,this.formRules[t]&&this.formRules[t].rules||[]),i.onFieldChange(this.formData[t])):null},validate(e,t){return this.checkAll(this.formData,e,t)},validateField(t=[],a){t=[].concat(t);let i={};return this.childrens.forEach((a=>{const l=e.realName(a.name);-1!==t.indexOf(l)&&(i=Object.assign({},i,{[l]:this.formData[l]}))})),this.checkAll(i,[],a)},clearValidate(t=[]){t=[].concat(t),this.childrens.forEach((a=>{if(0===t.length)a.errMsg="";else{const i=e.realName(a.name);-1!==t.indexOf(i)&&(a.errMsg="")}}))},submit(e,t,a){for(let i in this.dataValue){this.childrens.find((e=>e.name===i))&&void 0===this.formData[i]&&(this.formData[i]=this._getValue(i,this.dataValue[i]))}return a||console.warn("submit 方法即将废弃，请使用validate方法代替！"),this.checkAll(this.formData,e,t,"submit")},async checkAll(t,a,i,l){if(!this.validator)return;let s,r=[];for(let h in t){const t=this.childrens.find((t=>e.realName(t.name)===h));t&&r.push(t)}i||"function"!=typeof a||(i=a),!i&&"function"!=typeof i&&Promise&&(s=new Promise(((e,t)=>{i=function(a,i){a?t(a):e(i)}})));let n=[],o=JSON.parse(JSON.stringify(t));for(let h in r){const t=r[h];let a=e.realName(t.name);const i=await t.onFieldChange(o[a]);if(i&&(n.push(i),"toast"===this.errShowType||"modal"===this.errShowType))break}Array.isArray(n)&&0===n.length&&(n=null),Array.isArray(a)&&a.forEach((t=>{let a=e.realName(t),i=e.getDataValue(t,this.localData);void 0!==i&&(o[a]=i)})),"submit"===l?this.$emit("submit",{detail:{value:o,errors:n}}):this.$emit("validate",n);let u={};return u=e.rawData(o,this.name),i&&"function"==typeof i&&i(n,u),s&&i?s:null},validateCheck(e){this.$emit("validate",e)},_getValue:e.getValue,_isRequiredField:e.isRequiredField,_setDataValue:e.setDataValue,_getDataValue:e.getDataValue,_realName:e.realName,_isRealName:e.isRealName,_isEqual:e.isEqual}};const a=e._export_sfc(t,[["render",function(e,t,a,i,l,s){return{}}]]);wx.createComponent(a);
