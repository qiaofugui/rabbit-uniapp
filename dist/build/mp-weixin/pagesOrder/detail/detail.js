"use strict";const e=require("../../common/vendor.js"),r=require("../../composables/index.js"),t=require("../../services/constants.js"),a=require("../../services/order.js"),o=require("../../services/pay.js");if(require("../../utils/http.js"),require("../../stores/index.js"),require("../../stores/modules/member.js"),!Array){(e.resolveComponent("uni-countdown")+e.resolveComponent("XtxGuess")+e.resolveComponent("uni-popup"))()}Math||((()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-countdown/uni-countdown.js")+(()=>"../../components/XtxGuess.js")+n+(()=>"../../node-modules/@dcloudio/uni-ui/lib/uni-popup/uni-popup.js"))();const n=()=>"./components/PageSkeleton.js",u=e.defineComponent({__name:"detail",props:{id:null},setup(n){const u=n,{safeAreaInsets:l}=e.index.getSystemInfoSync(),{guessRef:i,onScrolltolower:s}=r.useGuessList(),d=e.ref(),c=e.ref(["商品无货","不想要了","商品信息填错了","地址信息填写错误","商品降价","其它"]),f=e.ref(""),v=getCurrentPages(),S=v.at(-1);e.onReady((()=>{S.animate(".navbar",[{backgroundColor:"transparent"},{backgroundColor:"#f8f8f8"}],1e3,{scrollSource:"#scroller",timeRange:1e3,startScrollOffset:0,endScrollOffset:50}),S.animate(".navbar .title",[{color:"transparent"},{color:"#000"}],1e3,{scrollSource:"#scroller",timeRange:1e3,startScrollOffset:0,endScrollOffset:50}),S.animate(".navbar .back",[{color:"#fff"},{color:"#000"}],1e3,{scrollSource:"#scroller",timeRange:1e3,startScrollOffset:0,endScrollOffset:50})}));const p=e.ref(),m=e.ref([]),g=async()=>{const e=await a.getMemberOrderLogisticsByIdAPI(u.id);m.value=e.result.list};e.onLoad((()=>{(async()=>{const e=await a.getMemberOrderByIdAPI(u.id);p.value=e.result,[t.OrderState.DaiShouHuo,t.OrderState.DaiPingJia,t.OrderState.YiWanCheng].includes(p.value.orderState)&&g()})()}));const O=()=>{p.value.orderState=t.OrderState.YiQuXiao},y=async()=>{{const r=await o.getPayWxPayMiniPayAPI({orderId:u.id});await e.wx$1.requestPayment(r.result)}e.index.redirectTo({url:`/pagesOrder/payment/payment?id=${u.id}`})},b=async()=>{},x=()=>{e.index.showModal({content:"为保障您的权益，请收到货并确认无误后，再确认收货",confirmColor:"#27BA9B",success:async e=>{if(e.confirm){const e=await a.putMemberOrderReceiptByIdAPI(u.id);p.value=e.result}}})},P=()=>{e.index.showModal({content:"是否删除订单",confirmColor:"#27BA9B",success:async r=>{r.confirm&&(await a.deleteMemberOrderAPI({ids:[u.id]}),e.index.redirectTo({url:"/pagesOrder/list/list"}))}})},w=async()=>{var r;const t=await a.getMemberOrderCancelByIdAPI(u.id,{cancelReason:f.value});p.value=t.result,null==(r=d.value)||r.close(),e.index.showToast({icon:"none",title:"订单取消成功"})};return(r,a)=>{var o,n,S;return e.e({a:e.unref(v).length>1},(e.unref(v).length,{}),{b:(null==(o=e.unref(l))?void 0:o.top)+"px",c:p.value},p.value?e.e({d:p.value.orderState===e.unref(t.OrderState).DaiFuKuan},p.value.orderState===e.unref(t.OrderState).DaiFuKuan?{e:e.t(p.value.payMoney),f:e.o(O),g:e.p({second:p.value.countdown,color:"#fff","splitor-color":"#fff","show-day":!1,"show-colon":!1}),h:e.o(y)}:e.e({i:e.t(e.unref(t.orderStateList)[p.value.orderState].text),j:`/pagesOrder/create/create?orderId=${u.id}`,k:e.unref(false)&&p.value.orderState==e.unref(t.OrderState).DaiFaHuo},e.unref(false)&&p.value.orderState==e.unref(t.OrderState).DaiFaHuo?{l:e.o(b)}:{},{m:p.value.orderState===e.unref(t.OrderState).DaiShouHuo},p.value.orderState===e.unref(t.OrderState).DaiShouHuo?{n:e.o(x)}:{}),{o:e.unref(l).top+20+"px",p:e.f(m.value,((r,t,a)=>({a:e.t(r.text),b:e.t(r.time),c:r.id}))),q:e.t(p.value.receiverContact),r:e.t(p.value.receiverMobile),s:e.t(p.value.receiverAddress),t:e.f(p.value.skus,((r,t,a)=>({a:r.image,b:e.t(r.name),c:e.t(r.attrsText),d:e.t(r.curPrice),e:e.t(r.quantity),f:r.id,g:`/pages/goods/goods?id=${r.spuId}`}))),v:p.value.orderState===e.unref(t.OrderState).DaiPingJia},(p.value.orderState,e.unref(t.OrderState).DaiPingJia,{}),{w:e.t(p.value.totalMoney),x:e.t(p.value.postFee),y:e.t(p.value.payMoney),z:e.t(u.id),A:e.o((r=>{return t=u.id,void e.index.setClipboardData({data:t});var t})),B:e.t(p.value.createTime),C:e.sr(i,"91fffa02-1",{k:"guessRef"}),D:(null==(n=e.unref(l))?void 0:n.bottom)+"px",E:p.value.orderState===e.unref(t.OrderState).DaiFuKuan},p.value.orderState===e.unref(t.OrderState).DaiFuKuan?{F:e.o(y),G:e.o((e=>{var r,t;return null==(t=null==(r=d.value)?void 0:r.open)?void 0:t.call(r)}))}:e.e({H:`/pagesOrder/create/create?orderId=${u.id}`,I:p.value.orderState===e.unref(t.OrderState).DaiShouHuo},p.value.orderState===e.unref(t.OrderState).DaiShouHuo?{J:e.o(x)}:{},{K:p.value.orderState===e.unref(t.OrderState).DaiPingJia},(p.value.orderState,e.unref(t.OrderState).DaiPingJia,{}),{L:p.value.orderState>=e.unref(t.OrderState).DaiPingJia},p.value.orderState>=e.unref(t.OrderState).DaiPingJia?{M:e.o(P)}:{}),{N:(null==(S=e.unref(l))?void 0:S.bottom)+"px"}):{},{O:e.o(((...r)=>e.unref(s)&&e.unref(s)(...r))),P:e.f(c.value,((r,t,a)=>({a:e.t(r),b:r===f.value?1:"",c:r,d:e.o((e=>f.value=r),r)}))),Q:e.o((e=>{var r,t;return null==(t=null==(r=d.value)?void 0:r.close)?void 0:t.call(r)})),R:e.o(w),S:e.sr(d,"91fffa02-3",{k:"popup"}),T:e.p({type:"bottom","background-color":"#fff"})})}}});wx.createPage(u);
