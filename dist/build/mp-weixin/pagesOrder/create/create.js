"use strict";const e=require("../../common/vendor.js"),t=require("../../services/order.js"),r=require("../../stores/modules/address.js");require("../../utils/http.js"),require("../../stores/index.js"),require("../../stores/modules/member.js");const u=e.defineComponent({__name:"create",props:{skuId:null,count:null,orderId:null},setup(u){const s=u,{safeAreaInsets:d}=e.index.getSystemInfoSync(),o=e.ref(""),a=e.ref([{type:1,text:"时间不限 (周一至周日)"},{type:2,text:"工作日送 (周一至周五)"},{type:3,text:"周末配送 (周六至周日)"}]),l=e.ref(0),n=e.computed((()=>a.value[l.value])),i=e=>{l.value=e.detail.value},c=e.ref();e.onLoad((()=>{(async()=>{if(s.count&&s.skuId){const e=await t.getMemberOrderPreNowAPI({count:s.count,skuId:s.skuId});c.value=e.result}else if(s.orderId){const e=await t.getMemberOrderRepurchaseByIdAPI(s.orderId);c.value=e.result}else{const e=await t.getMemberOrderPreAPI();c.value=e.result}})()}));const v=r.useAddressStore(),m=e.computed((()=>{var e;return v.selectedAddress||(null==(e=c.value)?void 0:e.userAddresses.find((e=>e.isDefault)))})),p=async()=>{var r,u;if(!(null==(r=m.value)?void 0:r.id))return e.index.showToast({icon:"none",title:"请选择收货地址"});const s=await t.postMemberOrderAPI({addressId:null==(u=m.value)?void 0:u.id,buyerMessage:o.value,deliveryTimeType:n.value.type,goods:c.value.goods.map((e=>({count:e.count,skuId:e.skuId}))),payChannel:2,payType:1});e.index.redirectTo({url:`/pagesOrder/detail/detail?id=${s.result.id}`})};return(t,r)=>{var u,s,l,v,f,y;return e.e({a:e.unref(m)},e.unref(m)?{b:e.t(e.unref(m).receiver),c:e.t(e.unref(m).contact),d:e.t(e.unref(m).fullLocation),e:e.t(e.unref(m).address)}:{},{f:e.f(null==(u=c.value)?void 0:u.goods,((t,r,u)=>({a:t.picture,b:e.t(t.name),c:e.t(t.attrsText),d:e.t(t.payPrice),e:e.t(t.price),f:e.t(t.count),g:t.skuId,h:`/pages/goods/goods?id=${t.id}`}))),g:e.t(e.unref(n).text),h:a.value,i:e.o(i),j:o.value,k:e.o((e=>o.value=e.detail.value)),l:e.t(null==(s=c.value)?void 0:s.summary.totalPrice.toFixed(2)),m:e.t(null==(l=c.value)?void 0:l.summary.postFee.toFixed(2)),n:e.t(null==(v=c.value)?void 0:v.summary.totalPayPrice.toFixed(2)),o:(null==(f=e.unref(m))?void 0:f.id)?"":1,p:e.o(p),q:(null==(y=e.unref(d))?void 0:y.bottom)+"px"})}}});wx.createPage(u);
