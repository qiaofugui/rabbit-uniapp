"use strict";const e=require("../../../common/vendor.js"),r=require("../../../services/constants.js"),t=require("../../../services/order.js"),a=require("../../../services/pay.js");require("../../../utils/http.js"),require("../../../stores/index.js"),require("../../../stores/modules/member.js");const i=e.defineComponent({__name:"OrderList",props:{orderState:null},setup(i){const o=i,{safeAreaInsets:n}=e.index.getSystemInfoSync(),d={page:1,pageSize:5,orderState:o.orderState},s=e.ref([]),u=e.ref(!1),c=async()=>{if(u.value)return;if(!0===l.value)return e.index.showToast({icon:"none",title:"没有更多数据~"});u.value=!0;const r=await t.getMemberOrderAPI(d);u.value=!1,s.value.push(...r.result.items),d.page<r.result.pages?d.page++:l.value=!0};e.onMounted((()=>{c()}));const l=e.ref(!1),f=e.ref(!1),v=async()=>{f.value=!0,d.page=1,s.value=[],l.value=!1,await c(),f.value=!1};return(i,o)=>{var d;return{a:e.f(s.value,((i,o,n)=>e.e({a:e.t(i.createTime),b:e.t(e.unref(r.orderStateList)[i.orderState].text),c:i.orderState>=e.unref(r.OrderState).DaiPingJia},i.orderState>=e.unref(r.OrderState).DaiPingJia?{d:e.o((r=>{return a=i.id,void e.index.showModal({content:"你确定要删除该订单？",confirmColor:"#27BA9B",success:async e=>{if(e.confirm){await t.deleteMemberOrderAPI({ids:[a]});const e=s.value.findIndex((e=>e.id===a));s.value.splice(e,1)}}});var a}),i.id)}:{},{e:e.f(i.skus,((r,t,a)=>({a:r.image,b:e.t(r.name),c:e.t(r.attrsText),d:r.id}))),f:`/pagesOrder/detail/detail?id=${i.id}`,g:e.t(i.totalNum),h:e.t(i.payMoney),i:i.orderState===e.unref(r.OrderState).DaiFuKuan},i.orderState===e.unref(r.OrderState).DaiFuKuan?{j:e.o((t=>(async t=>{{const r=await a.getPayWxPayMiniPayAPI({orderId:t});await e.wx$1.requestPayment(r.result)}e.index.showToast({title:"支付成功"}),s.value.find((e=>e.id===t)).orderState=r.OrderState.DaiFaHuo})(i.id)),i.id)}:e.e({k:`/pagesOrder/create/create?orderId=${i.id}`,l:i.orderState===e.unref(r.OrderState).DaiShouHuo},i.orderState===e.unref(r.OrderState).DaiShouHuo?{m:e.o((a=>{return o=i.id,void e.index.showModal({content:"为保障您的权益，请收到货并确认无误后，再确认收货",confirmColor:"#27BA9B",success:async a=>{a.confirm&&(await t.putMemberOrderReceiptByIdAPI(o),e.index.showToast({icon:"success",title:"确认收货成功"}),s.value.find((e=>e.id===o)).orderState=r.OrderState.DaiPingJia)}});var o}),i.id)}:{}),{n:i.id}))),b:e.t(l.value?"没有更多数据~":"正在加载..."),c:(null==(d=e.unref(n))?void 0:d.bottom)+"px",d:f.value,e:e.o(v),f:e.o(c)}}}});wx.createComponent(i);
