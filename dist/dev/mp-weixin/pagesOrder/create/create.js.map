{"version":3,"file":"create.js","sources":["../../../../../src/pagesOrder/create/create.vue","../../../../../uniPage:/cGFnZXNPcmRlclxjcmVhdGVcY3JlYXRlLnZ1ZQ"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport {\r\n  getMemberOrderPreAPI,\r\n  getMemberOrderPreNowAPI,\r\n  getMemberOrderRepurchaseByIdAPI,\r\n  postMemberOrderAPI,\r\n} from '@/services/order'\r\nimport { useAddressStore } from '@/stores/modules/address'\r\nimport type { OrderPreResult } from '@/types/order'\r\nimport { onLoad } from '@dcloudio/uni-app'\r\nimport { computed, ref } from 'vue'\r\n\r\n// 获取屏幕边界到安全区域距离\r\nconst { safeAreaInsets } = uni.getSystemInfoSync()\r\n// 订单备注\r\nconst buyerMessage = ref('')\r\n// 配送时间\r\nconst deliveryList = ref([\r\n  { type: 1, text: '时间不限 (周一至周日)' },\r\n  { type: 2, text: '工作日送 (周一至周五)' },\r\n  { type: 3, text: '周末配送 (周六至周日)' },\r\n])\r\n// 当前配送时间下标\r\nconst activeIndex = ref(0)\r\n// 当前配送时间\r\nconst activeDelivery = computed(() => deliveryList.value[activeIndex.value])\r\n// 修改配送时间\r\nconst onChangeDelivery: UniHelper.SelectorPickerOnChange = (ev) => {\r\n  activeIndex.value = ev.detail.value\r\n}\r\n\r\n// 页面参数\r\nconst query = defineProps<{\r\n  skuId?: string\r\n  count?: string\r\n  orderId?: string\r\n}>()\r\n\r\n// 获取订单信息\r\nconst orderPre = ref<OrderPreResult>()\r\nconst getMemberOrderPreData = async () => {\r\n  if (query.count && query.skuId) {\r\n    const res = await getMemberOrderPreNowAPI({\r\n      count: query.count,\r\n      skuId: query.skuId,\r\n    })\r\n    orderPre.value = res.result\r\n  } else if (query.orderId) {\r\n    // 再次购买\r\n    const res = await getMemberOrderRepurchaseByIdAPI(query.orderId)\r\n    orderPre.value = res.result\r\n  } else {\r\n    const res = await getMemberOrderPreAPI()\r\n    orderPre.value = res.result\r\n  }\r\n}\r\n\r\nonLoad(() => {\r\n  getMemberOrderPreData()\r\n})\r\n\r\nconst addressStore = useAddressStore()\r\n// 收货地址\r\nconst selecteAddress = computed(() => {\r\n  return addressStore.selectedAddress || orderPre.value?.userAddresses.find((v) => v.isDefault)\r\n})\r\n\r\n// 提交订单\r\nconst onOrderSubmit = async () => {\r\n  // 没有收货地址提醒\r\n  if (!selecteAddress.value?.id) {\r\n    return uni.showToast({ icon: 'none', title: '请选择收货地址' })\r\n  }\r\n  // 发送请求\r\n  const res = await postMemberOrderAPI({\r\n    addressId: selecteAddress.value?.id,\r\n    buyerMessage: buyerMessage.value,\r\n    deliveryTimeType: activeDelivery.value.type,\r\n    goods: orderPre.value!.goods.map((v) => ({ count: v.count, skuId: v.skuId })),\r\n    payChannel: 2,\r\n    payType: 1,\r\n  })\r\n  // 关闭当前页面，跳转到订单详情，传递订单id\r\n  uni.redirectTo({ url: `/pagesOrder/detail/detail?id=${res.result.id}` })\r\n}\r\n</script>\r\n\r\n<template>\r\n  <scroll-view enable-back-to-top scroll-y class=\"viewport\">\r\n    <!-- 收货地址 -->\r\n    <navigator\r\n      v-if=\"selecteAddress\"\r\n      class=\"shipment\"\r\n      hover-class=\"none\"\r\n      url=\"/pagesMember/address/address?from=order\"\r\n    >\r\n      <view class=\"user\"> {{ selecteAddress.receiver }} {{ selecteAddress.contact }} </view>\r\n      <view class=\"address\"> {{ selecteAddress.fullLocation }} {{ selecteAddress.address }} </view>\r\n      <text class=\"icon icon-right\"></text>\r\n    </navigator>\r\n    <navigator\r\n      v-else\r\n      class=\"shipment\"\r\n      hover-class=\"none\"\r\n      url=\"/pagesMember/address/address?from=order\"\r\n    >\r\n      <view class=\"address\"> 请选择收货地址 </view>\r\n      <text class=\"icon icon-right\"></text>\r\n    </navigator>\r\n\r\n    <!-- 商品信息 -->\r\n    <view class=\"goods\">\r\n      <navigator\r\n        v-for=\"item in orderPre?.goods\"\r\n        :key=\"item.skuId\"\r\n        :url=\"`/pages/goods/goods?id=${item.id}`\"\r\n        class=\"item\"\r\n        hover-class=\"none\"\r\n      >\r\n        <image class=\"picture\" :src=\"item.picture\" />\r\n        <view class=\"meta\">\r\n          <view class=\"name ellipsis\"> {{ item.name }} </view>\r\n          <view class=\"attrs\">{{ item.attrsText }}</view>\r\n          <view class=\"prices\">\r\n            <view class=\"pay-price symbol\">{{ item.payPrice }}</view>\r\n            <view class=\"price symbol\">{{ item.price }}</view>\r\n          </view>\r\n          <view class=\"count\">x{{ item.count }}</view>\r\n        </view>\r\n      </navigator>\r\n    </view>\r\n\r\n    <!-- 配送及支付方式 -->\r\n    <view class=\"related\">\r\n      <view class=\"item\">\r\n        <text class=\"text\">配送时间</text>\r\n        <picker :range=\"deliveryList\" range-key=\"text\" @change=\"onChangeDelivery\">\r\n          <view class=\"icon-fonts picker\">{{ activeDelivery.text }}</view>\r\n        </picker>\r\n      </view>\r\n      <view class=\"item\">\r\n        <text class=\"text\">订单备注</text>\r\n        <input\r\n          class=\"input\"\r\n          :cursor-spacing=\"30\"\r\n          placeholder=\"选题，建议留言前先与商家沟通确认\"\r\n          v-model=\"buyerMessage\"\r\n        />\r\n      </view>\r\n    </view>\r\n\r\n    <!-- 支付金额 -->\r\n    <view class=\"settlement\">\r\n      <view class=\"item\">\r\n        <text class=\"text\">商品总价: </text>\r\n        <text class=\"number symbol\">{{ orderPre?.summary.totalPrice.toFixed(2) }}</text>\r\n      </view>\r\n      <view class=\"item\">\r\n        <text class=\"text\">运费: </text>\r\n        <text class=\"number symbol\">{{ orderPre?.summary.postFee.toFixed(2) }}</text>\r\n      </view>\r\n    </view>\r\n  </scroll-view>\r\n\r\n  <!-- 吸底工具栏 -->\r\n  <view class=\"toolbar\" :style=\"{ paddingBottom: safeAreaInsets?.bottom + 'px' }\">\r\n    <view class=\"total-pay symbol\">\r\n      <text class=\"number\">{{ orderPre?.summary.totalPayPrice.toFixed(2) }}</text>\r\n    </view>\r\n    <view class=\"button\" :class=\"{ disabled: !selecteAddress?.id }\" @tap=\"onOrderSubmit\">\r\n      提交订单\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<style lang=\"scss\">\r\npage {\r\n  display: flex;\r\n  flex-direction: column;\r\n  height: 100%;\r\n  overflow: hidden;\r\n  background-color: #f4f4f4;\r\n}\r\n\r\n.symbol::before {\r\n  content: '¥';\r\n  font-size: 80%;\r\n  margin-right: 5rpx;\r\n}\r\n\r\n.shipment {\r\n  margin: 20rpx;\r\n  padding: 30rpx 30rpx 30rpx 84rpx;\r\n  font-size: 26rpx;\r\n  border-radius: 10rpx;\r\n  background: url(https://pcapi-xiaotuxian-front-devtest.itheima.net/miniapp/images/locate.png)\r\n    20rpx center / 50rpx no-repeat #fff;\r\n  position: relative;\r\n\r\n  .icon {\r\n    font-size: 36rpx;\r\n    color: #333;\r\n    transform: translateY(-50%);\r\n    position: absolute;\r\n    top: 50%;\r\n    right: 20rpx;\r\n  }\r\n\r\n  .user {\r\n    color: #333;\r\n    margin-bottom: 5rpx;\r\n  }\r\n\r\n  .address {\r\n    color: #666;\r\n  }\r\n}\r\n\r\n.goods {\r\n  margin: 20rpx;\r\n  padding: 0 20rpx;\r\n  border-radius: 10rpx;\r\n  background-color: #fff;\r\n\r\n  .item {\r\n    display: flex;\r\n    padding: 30rpx 0;\r\n    border-top: 1rpx solid #eee;\r\n\r\n    &:first-child {\r\n      border-top: none;\r\n    }\r\n\r\n    .picture {\r\n      width: 170rpx;\r\n      height: 170rpx;\r\n      border-radius: 10rpx;\r\n      margin-right: 20rpx;\r\n    }\r\n\r\n    .meta {\r\n      flex: 1;\r\n      display: flex;\r\n      flex-direction: column;\r\n      justify-content: center;\r\n      position: relative;\r\n    }\r\n\r\n    .name {\r\n      height: 80rpx;\r\n      font-size: 26rpx;\r\n      color: #444;\r\n    }\r\n\r\n    .attrs {\r\n      line-height: 1.8;\r\n      padding: 0 15rpx;\r\n      margin-top: 6rpx;\r\n      font-size: 24rpx;\r\n      align-self: flex-start;\r\n      border-radius: 4rpx;\r\n      color: #888;\r\n      background-color: #f7f7f8;\r\n    }\r\n\r\n    .prices {\r\n      display: flex;\r\n      align-items: baseline;\r\n      margin-top: 6rpx;\r\n      font-size: 28rpx;\r\n\r\n      .pay-price {\r\n        margin-right: 10rpx;\r\n        color: #cf4444;\r\n      }\r\n\r\n      .price {\r\n        font-size: 24rpx;\r\n        color: #999;\r\n        text-decoration: line-through;\r\n      }\r\n    }\r\n\r\n    .count {\r\n      position: absolute;\r\n      bottom: 0;\r\n      right: 0;\r\n      font-size: 26rpx;\r\n      color: #444;\r\n    }\r\n  }\r\n}\r\n\r\n.related {\r\n  margin: 20rpx;\r\n  padding: 0 20rpx;\r\n  border-radius: 10rpx;\r\n  background-color: #fff;\r\n\r\n  .item {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    min-height: 80rpx;\r\n    font-size: 26rpx;\r\n    color: #333;\r\n  }\r\n\r\n  .input {\r\n    flex: 1;\r\n    text-align: right;\r\n    margin: 20rpx 0;\r\n    padding-right: 20rpx;\r\n    font-size: 26rpx;\r\n    color: #999;\r\n  }\r\n\r\n  .item .text {\r\n    width: 125rpx;\r\n  }\r\n\r\n  .picker {\r\n    color: #666;\r\n  }\r\n\r\n  .picker::after {\r\n    content: '\\e6c2';\r\n  }\r\n}\r\n\r\n/* 结算清单 */\r\n.settlement {\r\n  margin: 20rpx;\r\n  padding: 0 20rpx;\r\n  border-radius: 10rpx;\r\n  background-color: #fff;\r\n\r\n  .item {\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: space-between;\r\n    height: 80rpx;\r\n    font-size: 26rpx;\r\n    color: #333;\r\n  }\r\n\r\n  .danger {\r\n    color: #cf4444;\r\n  }\r\n}\r\n\r\n/* 吸底工具栏 */\r\n.toolbar {\r\n  position: fixed;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: calc(var(--window-bottom));\r\n  z-index: 1;\r\n\r\n  background-color: #fff;\r\n  height: 100rpx;\r\n  padding: 0 20rpx;\r\n  border-top: 1rpx solid #eaeaea;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  box-sizing: content-box;\r\n\r\n  .total-pay {\r\n    font-size: 40rpx;\r\n    color: #cf4444;\r\n\r\n    .decimal {\r\n      font-size: 75%;\r\n    }\r\n  }\r\n\r\n  .button {\r\n    width: 220rpx;\r\n    text-align: center;\r\n    line-height: 72rpx;\r\n    font-size: 26rpx;\r\n    color: #fff;\r\n    border-radius: 72rpx;\r\n    background-color: #27ba9b;\r\n  }\r\n\r\n  .disabled {\r\n    opacity: 0.6;\r\n  }\r\n}\r\n</style>\r\n","import MiniProgramPage from 'E:/Temp/uniapp/rabbit-uniapp/src/pagesOrder/create/create.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","ref","computed","getMemberOrderPreNowAPI","getMemberOrderRepurchaseByIdAPI","getMemberOrderPreAPI","onLoad","useAddressStore","postMemberOrderAPI"],"mappings":";;;;;;;;;;;;;;;;AAaA,UAAM,EAAE,eAAA,IAAmBA,cAAA,MAAI,kBAAkB;AAE3C,UAAA,eAAeC,kBAAI,EAAE;AAE3B,UAAM,eAAeA,cAAAA,IAAI;AAAA,MACvB,EAAE,MAAM,GAAG,MAAM,eAAe;AAAA,MAChC,EAAE,MAAM,GAAG,MAAM,eAAe;AAAA,MAChC,EAAE,MAAM,GAAG,MAAM,eAAe;AAAA,IAAA,CACjC;AAEK,UAAA,cAAcA,kBAAI,CAAC;AAEzB,UAAM,iBAAiBC,cAAAA,SAAS,MAAM,aAAa,MAAM,YAAY,KAAK,CAAC;AAErE,UAAA,mBAAqD,CAAC,OAAO;AACrD,kBAAA,QAAQ,GAAG,OAAO;AAAA,IAAA;AAWhC,UAAM,WAAWD,cAAAA;AACjB,UAAM,wBAAwB,YAAY;AACpC,UAAA,MAAM,SAAS,MAAM,OAAO;AACxB,cAAA,MAAM,MAAME,uCAAwB;AAAA,UACxC,OAAO,MAAM;AAAA,UACb,OAAO,MAAM;AAAA,QAAA,CACd;AACD,iBAAS,QAAQ,IAAI;AAAA,MAAA,WACZ,MAAM,SAAS;AAExB,cAAM,MAAM,MAAMC,eAAAA,gCAAgC,MAAM,OAAO;AAC/D,iBAAS,QAAQ,IAAI;AAAA,MAAA,OAChB;AACC,cAAA,MAAM,MAAMC,eAAAA;AAClB,iBAAS,QAAQ,IAAI;AAAA,MACvB;AAAA,IAAA;AAGFC,kBAAAA,OAAO,MAAM;AACW;IAAA,CACvB;AAED,UAAM,eAAeC,uBAAAA;AAEf,UAAA,iBAAiBL,cAAAA,SAAS,MAAM;;AAC7B,aAAA,aAAa,qBAAmB,cAAS,UAAT,mBAAgB,cAAc,KAAK,CAAC,MAAM,EAAE;AAAA,IAAS,CAC7F;AAGD,UAAM,gBAAgB,YAAY;;AAE5B,UAAA,GAAC,oBAAe,UAAf,mBAAsB,KAAI;AAC7B,eAAOF,cAAAA,MAAI,UAAU,EAAE,MAAM,QAAQ,OAAO,WAAW;AAAA,MACzD;AAEM,YAAA,MAAM,MAAMQ,kCAAmB;AAAA,QACnC,YAAW,oBAAe,UAAf,mBAAsB;AAAA,QACjC,cAAc,aAAa;AAAA,QAC3B,kBAAkB,eAAe,MAAM;AAAA,QACvC,OAAO,SAAS,MAAO,MAAM,IAAI,CAAC,OAAO,EAAE,OAAO,EAAE,OAAO,OAAO,EAAE,MAAQ,EAAA;AAAA,QAC5E,YAAY;AAAA,QACZ,SAAS;AAAA,MAAA,CACV;AAEDR,0BAAI,WAAW,EAAE,KAAK,gCAAgC,IAAI,OAAO,MAAM;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AClFzE,GAAG,WAAW,eAAe;"}