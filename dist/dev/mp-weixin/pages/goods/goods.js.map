{"version":3,"file":"goods.js","sources":["../../../../../src/pages/goods/goods.vue","../../../../../uniPage:/cGFnZXMvZ29vZHMvZ29vZHMudnVl"],"sourcesContent":["<script setup lang=\"ts\">\r\nimport { getGoodsDetailAPI } from '@/services/goods'\r\nimport { postMemberCartAPI } from '@/services/cart'\r\nimport { onLoad } from '@dcloudio/uni-app'\r\nimport type { GoodsResult } from '@/types/goods'\r\nimport { ref, computed } from 'vue'\r\n\r\nimport PageSkeleton from './components/PageSkeleton.vue'\r\nimport AddressPanel from './components/AddressPanel.vue'\r\nimport ServicePanel from './components/ServicePanel.vue'\r\nimport type { SkuPopupEvent, SkuPopupInstance, SkuPopupLocaldata } from '@/components/vk-data-goods-sku-popup/vk-data-goods-sku-popup'\r\nimport { useAddressStore } from '@/stores/modules/address'\r\n\r\nconst addressStore = useAddressStore()\r\n\r\n// 获取屏幕边界到安全区域距离\r\nconst { safeAreaInsets } = uni.getSystemInfoSync()\r\n\r\n// 接收页面参数\r\nconst query = defineProps<{\r\n  id: string\r\n}>()\r\n\r\n// 获取商品详情\r\nconst goods = ref<GoodsResult>()\r\nconst getGoodsDetailData = async () => {\r\n  const res = await getGoodsDetailAPI(query.id)\r\n  goods.value = res.result\r\n\r\n  // sku组件所需格式\r\n  localdata.value = {\r\n    _id: res.result.id,\r\n    name: res.result.name,\r\n    goods_thumb: res.result.mainPictures[0],\r\n    spec_list: res.result.specs.map(v => ({\r\n      name: v.name,\r\n      list: v.values\r\n    })),\r\n    sku_list: res.result.skus.map(v => ({\r\n      _id: v.id,\r\n      goods_id: res.result.id,\r\n      goods_name: res.result.name,\r\n      image: v.picture,\r\n      price: v.price * 100, // sku 插件需要乘以100\r\n      stock: v.inventory,\r\n      sku_name_arr: v.specs.map(vv => vv.valueName),\r\n    }))\r\n  }\r\n}\r\n\r\nconst isLoading = ref(false)\r\n// 页面加载\r\nonLoad(async () => {\r\n  isLoading.value = true\r\n  await getGoodsDetailData()\r\n  isLoading.value = false\r\n})\r\n\r\n// 轮播图变化时\r\nconst currentIndex = ref(0)\r\nconst onChange: UniHelper.SwiperOnChange = (e) => {\r\n  currentIndex.value = e.detail!.current\r\n}\r\n\r\n// 点击图片时\r\nconst onTapImage = (url: string) => {\r\n  // 大图预览\r\n  uni.previewImage({\r\n    current: url,\r\n    urls: goods.value!.mainPictures\r\n  })\r\n}\r\n\r\n// uni-ui 弹出层组件ref\r\nconst popup = ref<{\r\n  open: (type?: UniHelper.UniPopupType) => void\r\n  close: () => void\r\n}>()\r\n\r\n// 控制弹出成条件渲染\r\nconst popupName = ref<'address' | 'service'>()\r\nconst openPopup = (name: typeof popupName.value) => {\r\n  // 修改弹出成名称\r\n  popupName.value = name\r\n  popup.value!.open()\r\n}\r\n\r\n// 是否显示sku\r\nconst isShowSku = ref(false)\r\n//商品信息\r\nconst localdata = ref({} as SkuPopupLocaldata)\r\n// 按钮的模式\r\nenum SkuMode {\r\n  Both = 1,\r\n  Cart = 2,\r\n  Buy = 3\r\n}\r\nconst mode = ref<SkuMode>(SkuMode.Both)\r\n// 打开sku弹窗修改按钮模式\r\nconst openSkuPopup = (val: SkuMode) => {\r\n  // 显示sku组件\r\n  isShowSku.value = true\r\n  // 修改按钮模式\r\n  mode.value = val\r\n}\r\n// sku 组件实例\r\nconst skuPopupRef = ref<SkuPopupInstance>()\r\n// 计算被选中的值\r\nconst selectArrText = computed(() => {\r\n  return skuPopupRef.value?.selectArr?.join(' ').trim() || '请选择商品规格'\r\n})\r\n\r\n// 加入购物车的事件\r\nconst onAddCart = async (e: SkuPopupEvent) => {\r\n  postMemberCartAPI({ skuId: e._id, count: e.buy_num })\r\n  uni.showToast({ title: '添加成功' })\r\n  isShowSku.value = false\r\n}\r\n\r\n// 立即购买\r\nconst onBuyNow = async (e: SkuPopupEvent) => {\r\n  uni.navigateTo({ url: `/pagesOrder/create/create?skuId=${e._id}&count=${e.buy_num}` })\r\n}\r\n</script>\r\n\r\n<template>\r\n  <PageSkeleton v-if=\"isLoading\" />\r\n\r\n  <view v-else>\r\n    <scroll-view scroll-y class=\"viewport\">\r\n      <!-- 基本信息 -->\r\n      <view class=\"goods\">\r\n        <!-- 商品主图 -->\r\n        <view class=\"preview\">\r\n          <swiper circular @change=\"onChange\">\r\n            <swiper-item v-for=\"item in goods?.mainPictures\" :key=\"item\">\r\n              <image mode=\"aspectFill\" :src=\"item\" @tap=\"onTapImage(item)\" />\r\n            </swiper-item>\r\n          </swiper>\r\n          <view class=\"indicator\">\r\n            <text class=\"current\">{{ currentIndex + 1 }}</text>\r\n            <text class=\"split\">/</text>\r\n            <text class=\"total\">{{ goods?.mainPictures.length }}</text>\r\n          </view>\r\n        </view>\r\n\r\n        <!-- 商品简介 -->\r\n        <view class=\"meta\">\r\n          <view class=\"price\">\r\n            <text class=\"symbol\">¥</text>\r\n            <text class=\"number\">{{ goods?.price }}</text>\r\n          </view>\r\n          <view class=\"name ellipsis\">{{ goods?.name }}</view>\r\n          <view class=\"desc\">{{ goods?.desc }}</view>\r\n        </view>\r\n\r\n        <!-- 操作面板 -->\r\n        <view class=\"action\">\r\n          <view class=\"item arrow\" @tap=\"openSkuPopup(SkuMode.Both)\">\r\n            <text class=\"label\">选择</text>\r\n            <text class=\"text ellipsis\"> {{ selectArrText }} </text>\r\n          </view>\r\n          <view class=\"item arrow\" @tap=\"openPopup('address')\">\r\n            <text class=\"label\">送至</text>\r\n            <text class=\"text ellipsis\"> {{ addressStore.selectedAddress?.fullLocation + addressStore.selectedAddress?.address || '请选择收获地址' }}\r\n            </text>\r\n          </view>\r\n          <view class=\"item arrow\" @tap=\"openPopup('service')\">\r\n            <text class=\"label\">服务</text>\r\n            <text class=\"text ellipsis\"> 无忧退 快速退款 免费包邮 </text>\r\n          </view>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 商品详情 -->\r\n      <view class=\"detail panel\">\r\n        <view class=\"title\">\r\n          <text>详情</text>\r\n        </view>\r\n        <view class=\"content\">\r\n          <view class=\"properties\">\r\n            <!-- 属性详情 -->\r\n            <view class=\"item\" v-for=\"item in goods?.details.properties\" :key=\"item.name\">\r\n              <text class=\"label\">{{ item.name }}</text>\r\n              <text class=\"value\">{{ item.value }}</text>\r\n            </view>\r\n          </view>\r\n          <!-- 图片详情 -->\r\n          <image mode=\"widthFix\" v-for=\"item in goods?.details.pictures\" :key=\"item\" :src=\"item\"></image>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 同类推荐 -->\r\n      <view class=\"similar panel\">\r\n        <view class=\"title\">\r\n          <text>同类推荐</text>\r\n        </view>\r\n        <view class=\"content\">\r\n          <navigator v-for=\"item in goods?.similarProducts\" :key=\"item.id\" class=\"goods\" hover-class=\"none\"\r\n            :url=\"`/pages/goods/goods?id=${item.id}}}`\">\r\n            <image class=\"image\" mode=\"aspectFill\" :src=\"item.picture\"></image>\r\n            <view class=\"name ellipsis\">{{ item.name }}</view>\r\n            <view class=\"price\">\r\n              <text class=\"symbol\">¥</text>\r\n              <text class=\"number\">{{ item.price }}</text>\r\n            </view>\r\n          </navigator>\r\n        </view>\r\n      </view>\r\n    </scroll-view>\r\n\r\n    <!-- 用户操作 -->\r\n    <view class=\"toolbar\" :style=\"{ paddingBottom: safeAreaInsets?.bottom + 'px' }\">\r\n      <view class=\"icons\">\r\n        <button class=\"icons-button\"><text class=\"icon-heart\"></text>收藏</button>\r\n        <button class=\"icons-button\" open-type=\"contact\">\r\n          <text class=\"icon-handset\"></text>客服\r\n        </button>\r\n        <navigator class=\"icons-button\" url=\"/pages/cart/cart2\" open-type=\"navigate\">\r\n          <text class=\"icon-cart\"></text>购物车\r\n        </navigator>\r\n      </view>\r\n      <view class=\"buttons\">\r\n        <view class=\"addcart\" @tap=\"openSkuPopup(SkuMode.Cart)\"> 加入购物车 </view>\r\n        <view class=\"buynow\" @tap=\"openSkuPopup(SkuMode.Buy)\"> 立即购买 </view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n\r\n  <!-- uni-ui 弹出层 -->\r\n  <uni-popup ref=\"popup\" type=\"bottom\" background-color=\"#fff\">\r\n    <view style=\"margin-bottom: 80rpx;\">\r\n      <AddressPanel v-if=\"popupName === 'address'\" @close=\"popup?.close()\" />\r\n      <ServicePanel v-if=\"popupName === 'service'\" @close=\"popup?.close()\" />\r\n    </view>\r\n  </uni-popup>\r\n\r\n  <!-- sku组件 -->\r\n  <vk-data-goods-sku-popup v-model=\"isShowSku\" :localdata=\"localdata\" :mode=\"mode\" add-cart-background-color=\"#FFA868\"\r\n    buy-cart-background-color=\"#27BA9B\" :actived-style=\"{\r\n      color: '#27BA9B',\r\n      borderColor: '#27BA9B',\r\n      backroundColor: '#27BA9B'\r\n    }\" @add-cart=\"onAddCart\" @buy-now=\"onBuyNow\" ref=\"skuPopupRef\" />\r\n</template>\r\n\r\n<style lang=\"scss\">\r\npage {\r\n  height: 100%;\r\n  display: flex;\r\n  flex-direction: column;\r\n}\r\n\r\n.viewport {\r\n  background-color: #f4f4f4;\r\n}\r\n\r\n.panel {\r\n  margin-top: 20rpx;\r\n  background-color: #fff;\r\n\r\n  .title {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    height: 90rpx;\r\n    line-height: 1;\r\n    padding: 30rpx 60rpx 30rpx 6rpx;\r\n    position: relative;\r\n\r\n    text {\r\n      padding-left: 10rpx;\r\n      font-size: 28rpx;\r\n      color: #333;\r\n      font-weight: 600;\r\n      border-left: 4rpx solid #27ba9b;\r\n    }\r\n\r\n    navigator {\r\n      font-size: 24rpx;\r\n      color: #666;\r\n    }\r\n  }\r\n}\r\n\r\n.arrow {\r\n  &::after {\r\n    position: absolute;\r\n    top: 50%;\r\n    right: 30rpx;\r\n    content: '\\e6c2';\r\n    color: #ccc;\r\n    font-family: 'erabbit' !important;\r\n    font-size: 32rpx;\r\n    transform: translateY(-50%);\r\n  }\r\n}\r\n\r\n/* 商品信息 */\r\n.goods {\r\n  background-color: #fff;\r\n\r\n  .preview {\r\n    height: 750rpx;\r\n    position: relative;\r\n\r\n    .indicator {\r\n      height: 40rpx;\r\n      padding: 0 24rpx;\r\n      line-height: 40rpx;\r\n      border-radius: 30rpx;\r\n      color: #fff;\r\n      font-family: Arial, Helvetica, sans-serif;\r\n      background-color: rgba(0, 0, 0, 0.3);\r\n      position: absolute;\r\n      bottom: 30rpx;\r\n      right: 30rpx;\r\n\r\n      .current {\r\n        font-size: 26rpx;\r\n      }\r\n\r\n      .split {\r\n        font-size: 24rpx;\r\n        margin: 0 1rpx 0 2rpx;\r\n      }\r\n\r\n      .total {\r\n        font-size: 24rpx;\r\n      }\r\n    }\r\n  }\r\n\r\n  .meta {\r\n    position: relative;\r\n    border-bottom: 1rpx solid #eaeaea;\r\n\r\n    .price {\r\n      height: 130rpx;\r\n      padding: 25rpx 30rpx 0;\r\n      color: #fff;\r\n      font-size: 34rpx;\r\n      box-sizing: border-box;\r\n      background-color: #35c8a9;\r\n    }\r\n\r\n    .number {\r\n      font-size: 56rpx;\r\n    }\r\n\r\n    .brand {\r\n      width: 160rpx;\r\n      height: 80rpx;\r\n      overflow: hidden;\r\n      position: absolute;\r\n      top: 26rpx;\r\n      right: 30rpx;\r\n    }\r\n\r\n    .name {\r\n      max-height: 88rpx;\r\n      line-height: 1.4;\r\n      margin: 20rpx;\r\n      font-size: 32rpx;\r\n      color: #333;\r\n    }\r\n\r\n    .desc {\r\n      line-height: 1;\r\n      padding: 0 20rpx 30rpx;\r\n      font-size: 24rpx;\r\n      color: #cf4444;\r\n    }\r\n  }\r\n\r\n  .action {\r\n    padding-left: 20rpx;\r\n\r\n    .item {\r\n      height: 90rpx;\r\n      padding-right: 60rpx;\r\n      border-bottom: 1rpx solid #eaeaea;\r\n      font-size: 26rpx;\r\n      color: #333;\r\n      position: relative;\r\n      display: flex;\r\n      align-items: center;\r\n\r\n      &:last-child {\r\n        border-bottom: 0 none;\r\n      }\r\n    }\r\n\r\n    .label {\r\n      width: 60rpx;\r\n      color: #898b94;\r\n      margin: 0 16rpx 0 10rpx;\r\n    }\r\n\r\n    .text {\r\n      flex: 1;\r\n      -webkit-line-clamp: 1;\r\n    }\r\n  }\r\n}\r\n\r\n/* 商品详情 */\r\n.detail {\r\n  padding-left: 20rpx;\r\n\r\n  .content {\r\n    margin-left: -20rpx;\r\n  }\r\n\r\n  .properties {\r\n    padding: 0 20rpx;\r\n    margin-bottom: 30rpx;\r\n\r\n    .item {\r\n      display: flex;\r\n      line-height: 2;\r\n      padding: 10rpx;\r\n      font-size: 26rpx;\r\n      color: #333;\r\n      border-bottom: 1rpx dashed #ccc;\r\n    }\r\n\r\n    .label {\r\n      width: 200rpx;\r\n    }\r\n\r\n    .value {\r\n      flex: 1;\r\n    }\r\n  }\r\n}\r\n\r\n/* 同类推荐 */\r\n.similar {\r\n  padding-left: 20rpx;\r\n  margin-bottom: 50rpx;\r\n\r\n  .content {\r\n    padding: 0 20rpx 20rpx;\r\n    margin-left: -20rpx;\r\n    background-color: #f4f4f4;\r\n    overflow: hidden;\r\n\r\n    navigator {\r\n      width: 345rpx;\r\n      padding: 24rpx 20rpx 20rpx;\r\n      margin: 20rpx 20rpx 0 0;\r\n      border-radius: 10rpx;\r\n      background-color: #fff;\r\n      float: left;\r\n    }\r\n\r\n    .image {\r\n      height: 260rpx;\r\n    }\r\n\r\n    .name {\r\n      height: 80rpx;\r\n      margin: 10rpx 0;\r\n      font-size: 26rpx;\r\n      color: #262626;\r\n    }\r\n\r\n    .price {\r\n      line-height: 1;\r\n      font-size: 20rpx;\r\n      color: #cf4444;\r\n    }\r\n\r\n    .number {\r\n      font-size: 26rpx;\r\n      margin-left: 2rpx;\r\n    }\r\n  }\r\n\r\n  navigator {\r\n    &:nth-child(even) {\r\n      margin-right: 0;\r\n    }\r\n  }\r\n}\r\n\r\n/* 底部工具栏 */\r\n.toolbar {\r\n  position: fixed;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: calc((var(--window-bottom)));\r\n  z-index: 1;\r\n  background-color: #fff;\r\n  height: 100rpx;\r\n  padding: 0 20rpx;\r\n  border-top: 1rpx solid #eaeaea;\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  box-sizing: content-box;\r\n\r\n  .buttons {\r\n    display: flex;\r\n\r\n    & > view {\r\n      width: 220rpx;\r\n      text-align: center;\r\n      line-height: 72rpx;\r\n      font-size: 26rpx;\r\n      color: #fff;\r\n      border-radius: 72rpx;\r\n    }\r\n\r\n    .addcart {\r\n      background-color: #ffa868;\r\n    }\r\n\r\n    .buynow {\r\n      background-color: #27ba9b;\r\n      margin-left: 20rpx;\r\n    }\r\n  }\r\n\r\n  .icons {\r\n    padding-right: 10rpx;\r\n    display: flex;\r\n    align-items: center;\r\n    flex: 1;\r\n\r\n    .icons-button {\r\n      flex: 1;\r\n      text-align: center;\r\n      line-height: 1.4;\r\n      padding: 0;\r\n      margin: 0;\r\n      border-radius: 0;\r\n      font-size: 20rpx;\r\n      color: #333;\r\n      background-color: #fff;\r\n    }\r\n\r\n    text {\r\n      display: block;\r\n      font-size: 34rpx;\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import MiniProgramPage from 'E:/Temp/uniapp/rabbit-uniapp/src/pages/goods/goods.vue'\nwx.createPage(MiniProgramPage)"],"names":["useAddressStore","uni","ref","getGoodsDetailAPI","onLoad","computed","postMemberCartAPI"],"mappings":";;;;;;;;;;;;;;;;;;AAOA,MAAA,eAAyB,MAAA;AACzB,MAAA,eAAyB,MAAA;AACzB,MAAA,eAAyB,MAAA;;;;;;;;AAIzB,UAAM,eAAeA,uBAAAA;AAGrB,UAAM,EAAE,eAAA,IAAmBC,cAAA,MAAI,kBAAkB;AAQjD,UAAM,QAAQC,cAAAA;AACd,UAAM,qBAAqB,YAAY;AACrC,YAAM,MAAM,MAAMC,eAAAA,kBAAkB,MAAM,EAAE;AAC5C,YAAM,QAAQ,IAAI;AAGlB,gBAAU,QAAQ;AAAA,QAChB,KAAK,IAAI,OAAO;AAAA,QAChB,MAAM,IAAI,OAAO;AAAA,QACjB,aAAa,IAAI,OAAO,aAAa,CAAC;AAAA,QACtC,WAAW,IAAI,OAAO,MAAM,IAAI,CAAM,OAAA;AAAA,UACpC,MAAM,EAAE;AAAA,UACR,MAAM,EAAE;AAAA,QAAA,EACR;AAAA,QACF,UAAU,IAAI,OAAO,KAAK,IAAI,CAAM,OAAA;AAAA,UAClC,KAAK,EAAE;AAAA,UACP,UAAU,IAAI,OAAO;AAAA,UACrB,YAAY,IAAI,OAAO;AAAA,UACvB,OAAO,EAAE;AAAA,UACT,OAAO,EAAE,QAAQ;AAAA;AAAA,UACjB,OAAO,EAAE;AAAA,UACT,cAAc,EAAE,MAAM,IAAI,CAAA,OAAM,GAAG,SAAS;AAAA,QAAA,EAC5C;AAAA,MAAA;AAAA,IACJ;AAGI,UAAA,YAAYD,kBAAI,KAAK;AAE3BE,kBAAAA,OAAO,YAAY;AACjB,gBAAU,QAAQ;AAClB,YAAM,mBAAmB;AACzB,gBAAU,QAAQ;AAAA,IAAA,CACnB;AAGK,UAAA,eAAeF,kBAAI,CAAC;AACpB,UAAA,WAAqC,CAAC,MAAM;AACnC,mBAAA,QAAQ,EAAE,OAAQ;AAAA,IAAA;AAI3B,UAAA,aAAa,CAAC,QAAgB;AAElCD,oBAAAA,MAAI,aAAa;AAAA,QACf,SAAS;AAAA,QACT,MAAM,MAAM,MAAO;AAAA,MAAA,CACpB;AAAA,IAAA;AAIH,UAAM,QAAQC,cAAAA;AAMd,UAAM,YAAYA,cAAAA;AACZ,UAAA,YAAY,CAAC,SAAiC;AAElD,gBAAU,QAAQ;AAClB,YAAM,MAAO;IAAK;AAId,UAAA,YAAYA,kBAAI,KAAK;AAErB,UAAA,YAAYA,kBAAI,CAAA,CAAuB;AAOvC,UAAA,OAAOA;MAAa;AAAA;AAAA;AAEpB,UAAA,eAAe,CAAC,QAAiB;AAErC,gBAAU,QAAQ;AAElB,WAAK,QAAQ;AAAA,IAAA;AAGf,UAAM,cAAcA,cAAAA;AAEd,UAAA,gBAAgBG,cAAAA,SAAS,MAAM;;AACnC,eAAO,uBAAY,UAAZ,mBAAmB,cAAnB,mBAA8B,KAAK,KAAK,WAAU;AAAA,IAAA,CAC1D;AAGK,UAAA,YAAY,OAAO,MAAqB;AAC5CC,sCAAkB,EAAE,OAAO,EAAE,KAAK,OAAO,EAAE,SAAS;AACpDL,oBAAAA,MAAI,UAAU,EAAE,OAAO,OAAQ,CAAA;AAC/B,gBAAU,QAAQ;AAAA,IAAA;AAId,UAAA,WAAW,OAAO,MAAqB;AACvCA,oBAAAA,MAAA,WAAW,EAAE,KAAK,mCAAmC,EAAE,aAAa,EAAE,UAAW,CAAA;AAAA,IAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxHvF,GAAG,WAAW,eAAe;"}